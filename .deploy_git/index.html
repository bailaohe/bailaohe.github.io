<!doctype html>



  


<html class="theme-next mist use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"/>




  <link href="//fonts.googleapis.com/css?family=Lato:300,400,700,400italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">



<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=0.5.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />





  <link rel="alternate" href="/atom.xml" title="bailaohe's blog" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=0.5.0" />






<meta property="og:type" content="website">
<meta property="og:title" content="bailaohe's blog">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="bailaohe's blog">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="bailaohe's blog">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: '博主'
    }
  };
</script>

  <title> bailaohe's blog </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">bailaohe's blog</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-home fa-fw"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-archive fa-fw"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-tags fa-fw"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/07/27/跟着tikv源码学Rust-1：main流程/" itemprop="url">
                  跟着tikv源码学Rust-1：main流程
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-07-27T13:37:11+08:00" content="2017-07-27">
              2017-07-27
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/programming/" itemprop="url" rel="index">
                    <span itemprop="name">programming</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="处理命令行参数：clap"><a href="#处理命令行参数：clap" class="headerlink" title="处理命令行参数：clap"></a>处理命令行参数：clap</h2><figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div></pre></td></tr></table></figure>
<h2 id="cfg和cfg-attr"><a href="#cfg和cfg-attr" class="headerlink" title="cfg和cfg_attr"></a>cfg和cfg_attr</h2><p>blabla …</p>
<h2 id="clippy插件"><a href="#clippy插件" class="headerlink" title="clippy插件"></a>clippy插件</h2><h2 id="配置文件解析：toml"><a href="#配置文件解析：toml" class="headerlink" title="配置文件解析：toml"></a>配置文件解析：toml</h2><h2 id="日志初始化"><a href="#日志初始化" class="headerlink" title="日志初始化"></a>日志初始化</h2>
          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/04/20/Use-SparkSQL-to-build-a-OLAP-database-across-different-datasources/" itemprop="url">
                  Use SparkSQL to build a OLAP database across different datasources
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-04-20T13:20:35+08:00" content="2016-04-20">
              2016-04-20
            </time>
          </span>

          

          
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="http://spark.apache.com" target="_blank" rel="external">Spark</a> is a large-scale data processing engine. <a href="https://spark.apache.org/docs/latest/sql-programming-guide.html" target="_blank" rel="external">SparkSQL</a>, one of its important component, can access the Hive metastore service to handle Hive tables directly. Furthermore, SparkSQL also provides approach to use data from other external datasources (JDBC to RDB, Mongo, HBase, etc).</p>
<h2 id="Original-Target"><a href="#Original-Target" class="headerlink" title="Original Target"></a>Original Target</h2><p>In my work, I need to handle data from different datasources (mostly Mysql &amp; Mongo) to generate the final OLAP query result. Our goal is to establish a universal data platform to access, especially to process <code>JOIN</code> operation across schema on multiple datasources.</p>
<h2 id="Approach-1-Pandas-ETL-engine"><a href="#Approach-1-Pandas-ETL-engine" class="headerlink" title="Approach-1: Pandas ETL engine"></a>Approach-1: Pandas ETL engine</h2><p>We originally used <a href="http://pandas.pydata.org/" target="_blank" rel="external">pandas</a> to load required schemas as (pandas) Dataframes and then process all data operations within memory. This approach, however, is</p>
<ul>
<li><strong>Time Consuming</strong>: requires great efforts to load dataframes into memory</li>
<li><strong>Lack of Scalability</strong>: cannot handle large-scale data well since the entire platform is resided in single node.</li>
<li><strong>Difficult to Access</strong>: needs pandas APIs to process all the data operations. There are methods to use SQL to handle pandas Dataframe (e.g., <a href="https://github.com/keeganmccallum/sql4pandas" target="_blank" rel="external">sql4pandas</a>), but the supported sql syntax is limited.</li>
</ul>
<p>At last, we come to Spark. In SparkSQL, the basic operational data unit is also <code>DataFrame</code>, no matter a table in RDB, a collection in MongoDB, or a document in ElasticSearch. Moreover, its <code>lazy evaluation</code> of Dataframe enable it to process ETL job until the time we really need to access it, which makes it efficient in data handling and aware of change of external datasource.</p>
<h2 id="Approach-2-PySpark-Jupyter-Notebook"><a href="#Approach-2-PySpark-Jupyter-Notebook" class="headerlink" title="Approach-2: PySpark Jupyter Notebook"></a>Approach-2: PySpark Jupyter Notebook</h2><p>The idea is very easy, we register all Dataframes as temporary tables at first. Then we can use sql via Spark SQLContext to operate multiple datasources directly. Its easy to setup the jupyter notebook environment using PySpark. You can check the following demo notebook at my github repository (<a href="https://github.com/bailaohe/spark-notebook" target="_blank" rel="external">here</a>). I post the source code as follows.</p>
<h3 id="Initialize-pySpark-Environment"><a href="#Initialize-pySpark-Environment" class="headerlink" title="Initialize pySpark Environment"></a>Initialize pySpark Environment</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> os</div><div class="line"><span class="keyword">import</span> sys</div><div class="line"></div><div class="line"><span class="comment"># Add support to access mysql</span></div><div class="line">SPARK_CLASSPATH = <span class="string">"./libs/mysql-connector-java-5.1.38-bin.jar"</span></div><div class="line"><span class="comment"># Add support to access mongo (from official)</span></div><div class="line">SPARK_CLASSPATH += <span class="string">":./libs/mongo-hadoop-core-1.5.2.jar"</span></div><div class="line">SPARK_CLASSPATH += <span class="string">":./libs/mongo-java-driver-3.2.2.jar"</span></div><div class="line"><span class="comment"># Add support to access mongo (from stratio) based on casbah libs</span></div><div class="line">SPARK_CLASSPATH += <span class="string">":./libs/casbah-commons_2.10-3.1.1.jar"</span></div><div class="line">SPARK_CLASSPATH += <span class="string">":./libs/casbah-core_2.10-3.1.1.jar"</span></div><div class="line">SPARK_CLASSPATH += <span class="string">":./libs/casbah-query_2.10-3.1.1.jar"</span></div><div class="line">SPARK_CLASSPATH += <span class="string">":./libs/spark-mongodb_2.10-0.11.1.jar"</span></div><div class="line"></div><div class="line"><span class="comment"># Set the environment variable SPARK_CLASSPATH</span></div><div class="line">os.environ[<span class="string">'SPARK_CLASSPATH'</span>] = SPARK_CLASSPATH</div><div class="line"></div><div class="line"><span class="comment"># Add pyspark to sys.path</span></div><div class="line">spark_home = os.environ.get(<span class="string">'SPARK_HOME'</span>, <span class="keyword">None</span>)</div><div class="line">sys.path.insert(<span class="number">0</span>, spark_home + <span class="string">"/python"</span>)</div><div class="line"></div><div class="line"><span class="comment"># Add the py4j to the path.</span></div><div class="line"><span class="comment"># You may need to change the version number to match your install</span></div><div class="line">sys.path.insert(<span class="number">0</span>, os.path.join(spark_home, <span class="string">'python/lib/py4j-0.9-src.zip'</span>))</div><div class="line"></div><div class="line"><span class="keyword">from</span> pyspark <span class="keyword">import</span> SparkContext</div><div class="line"><span class="keyword">from</span> pyspark <span class="keyword">import</span> SparkConf</div><div class="line"><span class="keyword">from</span> pyspark.sql <span class="keyword">import</span> SQLContext</div><div class="line"></div><div class="line"><span class="comment"># Initialize spark conf/context/sqlContext</span></div><div class="line">conf = SparkConf().setMaster(<span class="string">"local[*]"</span>).setAppName(<span class="string">'spark-etl'</span>)</div><div class="line">sc = SparkContext(conf=conf)</div><div class="line">sqlContext = SQLContext(sc)</div></pre></td></tr></table></figure>
<h3 id="Initial-Data-Access-Drivers-Mysql-Mongo-…"><a href="#Initial-Data-Access-Drivers-Mysql-Mongo-…" class="headerlink" title="Initial Data Access Drivers (Mysql/Mongo/…)"></a>Initial Data Access Drivers (Mysql/Mongo/…)</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 1. Initialize the mysql driver</span></div><div class="line">mysql_host = <span class="string">"YOUR_MYSQL_HOST"</span></div><div class="line">mysql_port = <span class="number">3306</span></div><div class="line">mysql_db = <span class="string">"YOUR_MYSQL_DB"</span></div><div class="line">mysql_user = <span class="string">"YOUR_MYSQL_USER"</span></div><div class="line">mysql_pass = <span class="string">"YOUR_MYSQL_PASS"</span></div><div class="line">mysql_driver = <span class="string">"com.mysql.jdbc.Driver"</span></div><div class="line"></div><div class="line">mysql_prod = sqlContext.read.format(<span class="string">"jdbc"</span>).options(</div><div class="line">    url=<span class="string">"jdbc:mysql://&#123;host&#125;:&#123;port&#125;/&#123;db&#125;"</span>.format(host=mysql_host, port=mysql_port, db=mysql_db),</div><div class="line">    driver = mysql_driver,</div><div class="line">    user=mysql_user,</div><div class="line">    password=mysql_pass)</div><div class="line"></div><div class="line"><span class="comment"># 2. Initalize the official mongo driver</span></div><div class="line">mongo_user = <span class="string">"YOUR_MONGO_USER"</span></div><div class="line">mongo_pass = <span class="string">"YOUR_MONGO_PASSWORD"</span></div><div class="line">mongo_host = <span class="string">"127.0.0.1"</span></div><div class="line">mongo_port = <span class="number">27017</span></div><div class="line">mongo_db = <span class="string">"test"</span></div></pre></td></tr></table></figure>
<h3 id="Register-Temporary-Tables-from-datasources-Mysql-Mongo-…"><a href="#Register-Temporary-Tables-from-datasources-Mysql-Mongo-…" class="headerlink" title="Register Temporary Tables from datasources (Mysql/Mongo/…)"></a>Register Temporary Tables from datasources (Mysql/Mongo/…)</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 1. Register mysql temporary tables</span></div><div class="line">df_deal = mysql_prod.load(dbtable = <span class="string">"YOUR_MYSQL_TABLE"</span>)</div><div class="line">df_deal.registerTempTable(<span class="string">"mysql_table"</span>)</div><div class="line"></div><div class="line"><span class="comment"># 2. Register mongo temporary tables</span></div><div class="line">sqlContext.sql(<span class="string">"CREATE TEMPORARY TABLE mongo_table USING com.stratio.datasource.mongodb OPTIONS (host '&#123;host&#125;:&#123;port&#125;', database '&#123;db&#125;', collection '&#123;table&#125;')"</span>.format(</div><div class="line">    host=mongo_host,</div><div class="line">    port=mongo_port,</div><div class="line">    db=mongo_db,</div><div class="line">    table=<span class="string">"demotbl"</span></div><div class="line">))</div></pre></td></tr></table></figure>
<p>Then We can use SparkSQL as follows:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">df_mongo = sqlContext.sql(<span class="string">"SELECT * FROM mongo_table limit 10"</span>)</div><div class="line">df_mongo.collect()</div></pre></td></tr></table></figure>
<h2 id="Approach-3-OLAP-SQL-Database-on-SparkSQL-Thrift"><a href="#Approach-3-OLAP-SQL-Database-on-SparkSQL-Thrift" class="headerlink" title="Approach-3: OLAP SQL Database on SparkSQL Thrift"></a>Approach-3: OLAP SQL Database on SparkSQL Thrift</h2><p>We take our step furthermore, we want to make our platform as a <strong>database</strong>, facilitate us to access it in our program via JDBC driver, and to support different legacy BI application (e.g., Tableau, QlikView).</p>
<p>As mentioned above, SparkSQL can use Hive metastore directly. Thus, we want to start the SparkSQL thriftserver accompy with Hive metastore service, establish the environment with some SparkSQL DDL statements to create the <code>symbol-links</code> to external datasources.</p>
<p>The work is also very easy, just share the same hive-site.xml between Hive metastore service and SparkSQL thriftserver. We post the content of hive-site.xml as follows. It’s only a toy settings without any Hadoop/HDFS/Mapreduce stuff to highlight the key points, you can adapt it quickly for production use.</p>
<h3 id="Config-hive-site-xml"><a href="#Config-hive-site-xml" class="headerlink" title="Config hive-site.xml"></a>Config hive-site.xml</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>javax.jdo.option.ConnectionURL<span class="tag">&lt;/<span class="name">name</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>jdbc:mysql://localhost:3306/hive?createDatabaseIfNotExist=true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">description</span>&gt;</span>JDBC connect string for a JDBC metastore<span class="tag">&lt;/<span class="name">description</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>javax.jdo.option.ConnectionDriverName<span class="tag">&lt;/<span class="name">name</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>com.mysql.jdbc.Driver<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">description</span>&gt;</span>Driver class name for a JDBC metastore<span class="tag">&lt;/<span class="name">description</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>javax.jdo.option.ConnectionUserName<span class="tag">&lt;/<span class="name">name</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>hive<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">description</span>&gt;</span>username to use against metastore database<span class="tag">&lt;/<span class="name">description</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>javax.jdo.option.ConnectionPassword<span class="tag">&lt;/<span class="name">name</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>Bh@840922<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">description</span>&gt;</span>password to use against metastore database<span class="tag">&lt;/<span class="name">description</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.metastore.uris<span class="tag">&lt;/<span class="name">name</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>thrift://localhost:9083<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">description</span>&gt;</span>Thrift URI for the remote metastore. Used by metastore client to connect to remote metastore.<span class="tag">&lt;/<span class="name">description</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.server2.thrift.port<span class="tag">&lt;/<span class="name">name</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>10000<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.server2.thrift.bind.host<span class="tag">&lt;/<span class="name">name</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>localhost<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="Start-the-SparkSQL-thriftserver-with-required-jars"><a href="#Start-the-SparkSQL-thriftserver-with-required-jars" class="headerlink" title="Start the SparkSQL thriftserver with required jars"></a>Start the SparkSQL thriftserver with required jars</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#!/bin/sh</span></div><div class="line"></div><div class="line"><span class="variable">$&#123;SPARK_HOME&#125;</span>/sbin/start-thriftserver.sh \</div><div class="line">  --jars <span class="variable">$&#123;WORKDIR&#125;</span>/libs/mongo-java-driver-3.2.2.jar, \</div><div class="line">  <span class="variable">$&#123;WORKDIR&#125;</span>/libs/casbah-commons_2.10-3.1.1.jar, \</div><div class="line">  <span class="variable">$&#123;WORKDIR&#125;</span>/libs/casbah-core_2.10-3.1.1.jar, \</div><div class="line">  <span class="variable">$&#123;WORKDIR&#125;</span>/libs/casbah-query_2.10-3.1.1.jar, \</div><div class="line">  <span class="variable">$&#123;WORKDIR&#125;</span>/libs/spark-mongodb_2.10-0.11.1.jar, \</div><div class="line">  <span class="variable">$&#123;WORKDIR&#125;</span>/libs/mysql-connector-java-5.1.38-bin.jar</div></pre></td></tr></table></figure>
<p>OK, everything is done! Now you can do the same thing as approach-2 to create a symbol-link to external mongo table as follows in your beeline client:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">CREATE</span> <span class="keyword">TEMPORARY</span> <span class="keyword">TABLE</span> mongo_table <span class="keyword">USING</span> com.stratio.datasource.mongodb OPTIONS (host <span class="string">'localhost:27017'</span>, <span class="keyword">database</span> <span class="string">'test'</span>, collection <span class="string">'demotbl'</span>);</div></pre></td></tr></table></figure>
<p>Then you can access it via normal query statement:</p>
<pre>
0: jdbc:hive2://localhost:10000> show tables;
+--------------+--------------+--+
|  tableName   | isTemporary  |
+--------------+--------------+--+
| mongo_table  | false        |
+--------------+--------------+--+
1 row selected (0.108 seconds)
0: jdbc:hive2://localhost:10000> select * from mongo_table;
+------+----+---------------------------+--+
|  x   | y  |            _id            |
+------+----+---------------------------+--+
| 1.0  | a  | 5715f227d2f82889971df7f1  |
| 2.0  | b  | 57170b5e582cb370c48f085c  |
+------+----+---------------------------+--+
2 rows selected (0.38 seconds)
</pre>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/02/24/2016-02-24-jvm-gc-related-stuff/" itemprop="url">
                  JVM GC related stuff
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-02-24T17:00:00+08:00" content="2016-02-24">
              2016-02-24
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/programming/" itemprop="url" rel="index">
                    <span itemprop="name">programming</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Some good tutorials I have read, maybe translate them in futher.</p>
<p><a href="http://javapapers.com/java/java-garbage-collection-introduction/" target="_blank" rel="external">http://javapapers.com/java/java-garbage-collection-introduction/</a></p>
<p><a href="http://www.cubrid.org/blog/tags/Garbage%20Collection/" target="_blank" rel="external">http://www.cubrid.org/blog/tags/Garbage%20Collection/</a></p>
<p><a href="http://www.javaworld.com/article/2078623/core-java/jvm-performance-optimization-part-1-a-jvm-technology-primer.html" target="_blank" rel="external">http://www.javaworld.com/article/2078623/core-java/jvm-performance-optimization-part-1-a-jvm-technology-primer.html</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/02/24/2016-02-24-scala-features-to-best-practices-5-implicits/" itemprop="url">
                  scala features to best practices [5]: implicits
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-02-24T15:00:00+08:00" content="2016-02-24">
              2016-02-24
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/programming/" itemprop="url" rel="index">
                    <span itemprop="name">programming</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Implicit conversions and implicit parameters are Scala’s power tools that do useful work behind the scenes. With implicits, you can provide elegant libraries that hide tedious details from library users.</p>
<h2 id="FT-6-implicit-conversion-via-implicit-method-class"><a href="#FT-6-implicit-conversion-via-implicit-method-class" class="headerlink" title="FT-6: implicit conversion (via implicit method/class)"></a>FT-6: implicit conversion (via implicit method/class)</h2><p>An implicit conversion from type S to type T is defined by an implicit value which has function type S =&gt; T, or by an implicit method convertible to a value of that type. Implicit conversions are applied in two situations:</p>
<ul>
<li>If an expression e is of type S, and S does not conform to the expression’s expected type T.</li>
<li>In a selection e.m with e of type T, if the selector m does not denote a member of T.</li>
</ul>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">implicit</span> <span class="function"><span class="keyword">def</span> <span class="title">double2Int</span></span>(d: <span class="type">Double</span>) = d.toInt</div><div class="line"><span class="keyword">val</span> x: <span class="type">Int</span> = <span class="number">42.0</span></div></pre></td></tr></table></figure>
<h3 id="SC-6-1-enrich-an-existing-class"><a href="#SC-6-1-enrich-an-existing-class" class="headerlink" title="SC-6-1: enrich an existing class"></a>SC-6-1: enrich an existing class</h3><p>Rather than create a separate library of String utility methods, like a StringUtilities class, you want to add your own behavior(s) to the String class, so you can write code like this:</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="string">"HAL"</span>.increment</div></pre></td></tr></table></figure>
<p>Instead of this:<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="type">StringUtilities</span>.increment(<span class="string">"HAL"</span>)</div></pre></td></tr></table></figure></p>
<p>Then we can enrich the String class with an implicit method as follows:</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// define a method named increment in a normal Scala class:</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">StringImprovements</span>(<span class="params">val s: <span class="type">String</span></span>) </span>&#123;</div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">increment</span> </span>= s.map(c =&gt; (c + <span class="number">1</span>).toChar)</div><div class="line">&#125;</div><div class="line"><span class="comment">// define another method to handle the implicit conversion:</span></div><div class="line"><span class="keyword">implicit</span> <span class="function"><span class="keyword">def</span> <span class="title">stringToString</span></span>(s: <span class="type">String</span>) = <span class="keyword">new</span> <span class="type">StringImprovements</span>(s)</div></pre></td></tr></table></figure>
<p>When you call <code>increment</code> on a String, which does not has that method at all. Thus, the compiler find the compatible one <code>StringImprovements</code> and convert the string to StringImprovements via the implicit method <code>stringToString</code>, this is the scenario-2 mentioned above.</p>
<p>Scala 2.10 introduced a new feature called implicit classes. An implicit class is a class marked with the implicit keyword. This keyword makes the class’ primary constructor available for implicit conversions when the class is in scope. This is similar to <code>monkey patching</code> in Ruby, and <code>Meta-Programming</code> in Groovy.</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">implicit</span> <span class="class"><span class="keyword">class</span> <span class="title">StringImprovements</span>(<span class="params">s: <span class="type">String</span></span>) </span>&#123;</div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">increment</span> </span>= s.map(c =&gt; (c + <span class="number">1</span>).toChar)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>In real-world code, this is just slightly more complicated. According to <a href="http://docs.scala-lang.org/sips/completed/implicit-classes.html" target="_blank" rel="external">SIP-13, Implicit Classes</a></p>
<blockquote>
<p>An implicit class must be defined in a scope where method definitions are allowed (not at the top level).</p>
</blockquote>
<p>This means that your implicit class must be defined inside a class, object, or package object. You can also check some other restrictions of implicit class here: <a href="http://docs.scala-lang.org/overviews/core/implicit-classes.html" target="_blank" rel="external">http://docs.scala-lang.org/overviews/core/implicit-classes.html</a></p>
<h2 id="FT-7-implicit-parameter"><a href="#FT-7-implicit-parameter" class="headerlink" title="FT-7: implicit parameter"></a>FT-7: implicit parameter</h2><p>A method with implicit parameters can be applied to arguments just like a normal method. In this case the implicit label has no effect. However, if such a method misses arguments for its implicit parameters, such arguments will be automatically provided.</p>
<p>The actual arguments that are eligible to be passed to an implicit parameter fall into two categories:</p>
<ul>
<li>First, eligible are all identifiers x that can be accessed at the point of the method call without a prefix and that denote an implicit definition or an implicit parameter.</li>
<li>Second, eligible are also all members of companion modules of the implicit parameter’s type that are labeled implicit.</li>
</ul>
<h3 id="SC-7-1-default-parameter-value"><a href="#SC-7-1-default-parameter-value" class="headerlink" title="SC-7-1: default parameter value"></a>SC-7-1: default parameter value</h3><p>Implicits can be used to declare a value to be provided as a default as long as an implicit value is set with in the scope.</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">howMuchCanIMake_?</span></span>(hours: <span class="type">Int</span>)(<span class="keyword">implicit</span> dollarsPerHour: <span class="type">BigDecimal</span>) = dollarsPerHour * hours</div><div class="line"></div><div class="line"><span class="keyword">implicit</span> <span class="keyword">var</span> hourlyRate = <span class="type">BigDecimal</span>(<span class="number">34.00</span>)</div></pre></td></tr></table></figure>
<p>What’s the advantage this solution takes over the simple default value in parameter definition? The search of implicit value can be taken in the scope of <code>companion object</code>, and thus you can keep the default value <code>private</code> from the caller.</p>
<h3 id="SC-7-2-implicit-conversion-via-implicit-parameter"><a href="#SC-7-2-implicit-conversion-via-implicit-parameter" class="headerlink" title="SC-7-2: implicit conversion via implicit parameter"></a>SC-7-2: implicit conversion via implicit parameter</h3><p>An implicit function parameter is also usable as an implicit conversion, and it’s more flexible than the traditional solution. Check the following codes:</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">smaller</span></span>[<span class="type">T</span>](a: <span class="type">T</span>, b: <span class="type">T</span>)(<span class="keyword">implicit</span> order: <span class="type">T</span> =&gt; <span class="type">Ordered</span>[<span class="type">T</span>])</div><div class="line">  = <span class="keyword">if</span> (a &lt; b) a <span class="keyword">else</span> b <span class="comment">// Calls order(a) &lt; b if a doesn't have a &lt; operator</span></div></pre></td></tr></table></figure>
<p>Note that <code>order</code> is a function with a single parameter, is tagged implicit, and has a name that is a single identifier. Therefore, it is an implicit conversion, in addition to being an implicit parameter. So, we can omit the call to order in the body of the function</p>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/02/24/2016-02-24-scala-features-to-best-practices-4-closure/" itemprop="url">
                  scala features to best practices [4]: closure
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-02-24T11:00:00+08:00" content="2016-02-24">
              2016-02-24
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/programming/" itemprop="url" rel="index">
                    <span itemprop="name">programming</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="FT-5-closure"><a href="#FT-5-closure" class="headerlink" title="FT-5: closure"></a>FT-5: closure</h2><p>You want to pass a function around like a variable, and while doing so, you want that function to be able to refer to one or more fields that were in the same scope as the function when it was declared.</p>
<p>In his excellent article, Closures in Ruby, Paul Cantrell states</p>
<blockquote>
<p>A closure is a block of code which meets three criteria</p>
</blockquote>
<p>He defines the criteria as follows:</p>
<ol>
<li>The block of code can be passed around as a value, and</li>
<li>It can be executed on demand by anyone who has that value, at which time</li>
<li>It can refer to variables from the context in which it was created (i.e., it is closed with respect to variable access, in the mathematical sense of the word “closed”).</li>
</ol>
<p>Scala Cookbook, give a more graphic metaphor:</p>
<blockquote>
<p>I like to think of a closure as being like <code>quantum entanglement</code>, which Ein‐ stein referred to as “a spooky action at a distance.” Just as quantum entanglement begins with two elements that are together and then separated—but somehow remain aware of each other—a closure begins with a function and a variable defined in the same scope, which are then separated from each other. When the function is executed at some other point in space (scope) and time, it is magically still aware of the variable it referenced in their earlier time together, and even picks up any changes to that variable.</p>
</blockquote>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> votingAge = <span class="number">18</span></div><div class="line"><span class="keyword">val</span> isOfVotingAge = (age: <span class="type">Int</span>) =&gt; age &gt;= votingAge</div><div class="line"></div><div class="line">isOfVotingAge(<span class="number">16</span>) <span class="comment">// false</span></div><div class="line">isOfVotingAge(<span class="number">20</span>) <span class="comment">// true</span></div><div class="line"></div><div class="line"><span class="comment">// change votingAge in one scope</span></div><div class="line">votingAge = <span class="number">21</span></div><div class="line"><span class="comment">// the change to votingAge affects the result</span></div><div class="line">printResult(isOfVotingAge, <span class="number">20</span>) <span class="comment">// now false</span></div><div class="line"></div><div class="line"><span class="comment">// `printResult` and `votingAge` can be far from each other in a light year</span></div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/02/24/2016-02-24-scala-features-to-best-practices-3-case-class/" itemprop="url">
                  scala features to best practices [3]: case class
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-02-24T10:00:00+08:00" content="2016-02-24">
              2016-02-24
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/programming/" itemprop="url" rel="index">
                    <span itemprop="name">programming</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="FT-4-case-class"><a href="#FT-4-case-class" class="headerlink" title="FT-4: case class"></a>FT-4: case class</h2><h3 id="SC-4-1-build-boilerplate-code"><a href="#SC-4-1-build-boilerplate-code" class="headerlink" title="SC-4-1: build boilerplate code"></a>SC-4-1: build boilerplate code</h3><p>You’re working with match expressions, actors, or other situations where you want to use the case class syntax to generate boilerplate code, including accessor and mutator methods, along with apply, unapply, toString, equals, and hashCode methods, and more.</p>
<p>Define your class as a case class, defining any parameters it needs in its constructor</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// name and relation are 'val' by default</span></div><div class="line"><span class="keyword">case</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span>(<span class="params">name: <span class="type">String</span>, relation: <span class="type">String</span></span>)</span></div></pre></td></tr></table></figure>
<p>Defining a class as a case class results in a lot of boilerplate code being generated, with the following benefits:</p>
<ul>
<li>An apply method is generated, so you don’t need to use the new keyword to create a new instance of the class.</li>
<li>Accessor methods are generated for the constructor parameters because case class constructor parameters are val by default. Mutator methods are also generated for parameters declared as var.</li>
<li>A good, default toString method is generated.</li>
<li>An unapply method is generated, making it easy to use case classes in match expressions.</li>
<li>equals and hashCode methods are generated.</li>
<li>A copy method is generated.</li>
</ul>
<h3 id="SC-4-2-pattern-match-via-constructor-pattern"><a href="#SC-4-2-pattern-match-via-constructor-pattern" class="headerlink" title="SC-4-2: pattern match via constructor pattern"></a>SC-4-2: pattern match via constructor pattern</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">trait</span> <span class="title">Animal</span></span></div><div class="line"></div><div class="line"><span class="keyword">case</span> <span class="class"><span class="keyword">class</span> <span class="title">Dog</span>(<span class="params">name: <span class="type">String</span></span>) <span class="keyword">extends</span> <span class="title">Animal</span></span></div><div class="line"><span class="keyword">case</span> <span class="class"><span class="keyword">class</span> <span class="title">Cat</span>(<span class="params">name: <span class="type">String</span></span>) <span class="keyword">extends</span> <span class="title">Animal</span></span></div><div class="line"><span class="keyword">case</span> <span class="class"><span class="keyword">object</span> <span class="title">Woodpecker</span> <span class="keyword">extends</span> <span class="title">Animal</span></span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">object</span> <span class="title">CaseClassTest</span> <span class="keyword">extends</span> <span class="title">App</span> </span>&#123;</div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">determineType</span></span>(x: <span class="type">Animal</span>): <span class="type">String</span> = x <span class="keyword">match</span> &#123;</div><div class="line">    <span class="keyword">case</span> <span class="type">Dog</span>(moniker) =&gt; <span class="string">"Got a Dog, name = "</span> + moniker</div><div class="line">    <span class="keyword">case</span> _:<span class="type">Cat</span> =&gt; <span class="string">"Got a Cat (ignoring the name)"</span></div><div class="line">    <span class="keyword">case</span> <span class="type">Woodpecker</span> =&gt; <span class="string">"That was a Woodpecker"</span></div><div class="line">    <span class="keyword">case</span> _ =&gt; <span class="string">"That was something else"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/02/23/2016-02-23-scala-features-to-best-practices-2-companion-object/" itemprop="url">
                  Scala features to best practices [2]: companion object
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-02-23T00:00:00+08:00" content="2016-02-23">
              2016-02-23
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/programming/" itemprop="url" rel="index">
                    <span itemprop="name">programming</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="FT-3-companion-object"><a href="#FT-3-companion-object" class="headerlink" title="FT-3: companion object"></a>FT-3: companion object</h2><p>Define nonstatic (instance) members in your class, and define members that you want to appear as “static” members in an object that has the same name as the class, and is in the same file as the class. This object is known as a <code>companion object</code>.</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Pizza class</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Pizza</span> (<span class="params">var crustType: <span class="type">String</span></span>) </span>&#123;</div><div class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">toString</span> </span>= <span class="string">"Crust type is "</span> + crustType</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// companion object</span></div><div class="line"><span class="class"><span class="keyword">object</span> <span class="title">Pizza</span> </span>&#123;</div><div class="line">  <span class="keyword">val</span> <span class="type">CRUST_TYPE_THIN</span> = <span class="string">"thin"</span></div><div class="line">  <span class="keyword">val</span> <span class="type">CRUST_TYPE_THICK</span> = <span class="string">"thick"</span></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">getFoo</span> </span>= <span class="string">"Foo"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Although this approach is different than Java, the recipe is straightforward:</p>
<ul>
<li>Define your class and object in the same file, giving them the same name.</li>
<li>Define members that should appear to be “static” in the object.</li>
<li>Define nonstatic (instance) members in the class.</li>
</ul>
<h3 id="SC-3-1-accessing-private-members"><a href="#SC-3-1-accessing-private-members" class="headerlink" title="SC-3-1: accessing private members"></a>SC-3-1: accessing private members</h3><p>It’s also important to know that a class and its companion object can access each other’s private members. In the following code, the “static” method double in the object can access the private variable secret of the class Foo:</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span> </span>&#123;</div><div class="line">  <span class="keyword">private</span> <span class="keyword">val</span> secret = <span class="number">2</span></div><div class="line">&#125;</div><div class="line"><span class="class"><span class="keyword">object</span> <span class="title">Foo</span> </span>&#123;</div><div class="line">  <span class="comment">// access the private class field 'secret'</span></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">double</span></span>(foo: <span class="type">Foo</span>) = foo.secret * <span class="number">2</span></div><div class="line">&#125;</div><div class="line"><span class="class"><span class="keyword">object</span> <span class="title">Driver</span> <span class="keyword">extends</span> <span class="title">App</span> </span>&#123;</div><div class="line">  <span class="keyword">val</span> f = <span class="keyword">new</span> <span class="type">Foo</span> println(<span class="type">Foo</span>.double(f)) <span class="comment">// prints 4</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Similarly, in the following code, the instance member printObj can access the private field obj of the object Foo:</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span> </span>&#123;</div><div class="line">  <span class="comment">// access the private object field 'obj'</span></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">printObj</span> </span>&#123; println(<span class="string">s"I can see <span class="subst">$&#123;Foo.obj&#125;</span>"</span>) &#125;</div><div class="line">&#125;</div><div class="line"><span class="class"><span class="keyword">object</span> <span class="title">Foo</span> </span>&#123;</div><div class="line">  <span class="keyword">private</span> <span class="keyword">val</span> obj = <span class="string">"Foo's object"</span></div><div class="line">&#125;</div><div class="line"><span class="class"><span class="keyword">object</span> <span class="title">Driver</span> <span class="keyword">extends</span> <span class="title">App</span> </span>&#123;</div><div class="line">  <span class="keyword">val</span> f = <span class="keyword">new</span> <span class="type">Foo</span></div><div class="line">  f.printObj</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="SC-3-2-private-primary-constructor"><a href="#SC-3-2-private-primary-constructor" class="headerlink" title="SC-3-2: private primary constructor"></a>SC-3-2: private primary constructor</h3><p>A simple way to enforce the Singleton pattern in Scala is to make the primary constructor private, then put a getInstance method in the companion object of the class:</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Brain</span> <span class="title">private</span> </span>&#123;</div><div class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">toString</span> </span>= <span class="string">"This is the brain."</span></div><div class="line">&#125;</div><div class="line"><span class="class"><span class="keyword">object</span> <span class="title">Brain</span> </span>&#123;</div><div class="line">  <span class="keyword">val</span> brain = <span class="keyword">new</span> <span class="type">Brain</span> <span class="function"><span class="keyword">def</span> <span class="title">getInstance</span> </span>= brain</div><div class="line">&#125;</div><div class="line"><span class="class"><span class="keyword">object</span> <span class="title">SingletonTest</span> <span class="keyword">extends</span> <span class="title">App</span> </span>&#123;</div><div class="line">  <span class="comment">// this won't compile</span></div><div class="line">  <span class="comment">// val brain = new Brain</span></div><div class="line"></div><div class="line">  <span class="comment">// this works</span></div><div class="line">  <span class="keyword">val</span> brain = <span class="type">Brain</span>.getInstance</div><div class="line">      println(brain)</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="SC-3-3-creating-instances-without-new-keyword"><a href="#SC-3-3-creating-instances-without-new-keyword" class="headerlink" title="SC-3-3: creating instances without new keyword"></a>SC-3-3: creating instances without <code>new</code> keyword</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</div><div class="line">  <span class="keyword">var</span> name: <span class="type">String</span> = _</div><div class="line">&#125;</div><div class="line"><span class="class"><span class="keyword">object</span> <span class="title">Person</span> </span>&#123;</div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">apply</span></span>(name: <span class="type">String</span>): <span class="type">Person</span> = &#123;</div><div class="line">    <span class="keyword">var</span> p = <span class="keyword">new</span> <span class="type">Person</span> p.name = name</div><div class="line">    p</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>The <code>apply</code> method in a companion object is treated specially by the Scala compiler and lets you create new instances of your class without requiring the new keyword.</p>
<p>The problem can also be addressed by declaring your class as a <code>case class</code>. This works because the case class generates an apply method in a companion object for you. However, it’s important to know that a case class creates much more code for you than just the apply method. </p>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/02/22/2016-02-22-xiaomei-bi-design/" itemprop="url">
                  xiaomei BI design
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-02-22T00:00:00+08:00" content="2016-02-22">
              2016-02-22
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/bigdata/" itemprop="url" rel="index">
                    <span itemprop="name">bigdata</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="submodule"><a href="#submodule" class="headerlink" title="submodule"></a>submodule</h2><ul>
<li>schema service (readlonly)<ul>
<li>scan a s pecified driver url to load a bunch of schemas</li>
<li>manually create a schema</li>
<li>query the schema types</li>
<li>guess the schema of some schemaless datastore</li>
</ul>
</li>
<li>report service<ul>
<li>a store system of widget</li>
<li>layout placeholder</li>
</ul>
</li>
<li>analyse service<ul>
<li>workflow view</li>
<li>schema view</li>
<li>publish servicei</li>
</ul>
</li>
</ul>
<h2 id="Concepts"><a href="#Concepts" class="headerlink" title="Concepts"></a>Concepts</h2><p>a dataframe can be modeled as a sequence of transformations closure over an init <em>raw</em> dataframe</p>
<p>the sequence os ops can be lazily computed and any dataframe can be specified as a snapshot at a position</p>
<p>the data-content of the frame can only be generated by computed along the sequence, but the schema of the dataframe can be deduced </p>
<p>widget includes:</p>
<ul>
<li>config:<ul>
<li>schema-key (from schema service)</li>
<li>access-rule</li>
<li>parameters</li>
<li>query</li>
</ul>
</li>
<li>front-end:<ul>
<li>JS (data-access api)</li>
<li>CSS</li>
<li>resources</li>
</ul>
</li>
</ul>
<h2 id="FAQ"><a href="#FAQ" class="headerlink" title="FAQ"></a>FAQ</h2><ol>
<li>to add</li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/02/22/2016-02-22-scala-features-to-best-practices-1-delayed-evaluation/" itemprop="url">
                  Scala features to best practices [1]: delayed evaluation
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-02-22T00:00:00+08:00" content="2016-02-22">
              2016-02-22
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/programming/" itemprop="url" rel="index">
                    <span itemprop="name">programming</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="features-delayed-evaluation"><a href="#features-delayed-evaluation" class="headerlink" title="features: delayed evaluation"></a>features: delayed evaluation</h2><p>I’d like to use the term <code>delayed evaluation</code> to cover following two features in scala: <code>lazy var/val</code> and <code>byname parameter</code>. They are not quite related to each other, but both are to postpone the evaluation of a given expression or block for the final result.</p>
<h2 id="FT-1-lazy-var-val"><a href="#FT-1-lazy-var-val" class="headerlink" title="FT-1: lazy var/val"></a>FT-1: lazy var/val</h2><p>Defining a field as <code>lazy</code> is a useful approach when the field might not be accessed in the normal processing of your algorithms, or if running the algorithm will take a long time, and you want to defer that to a later time.</p>
<p>At present, I think its useful in following scenarios:</p>
<h3 id="SC-1-1-field-initialization-takes-great-efforts"><a href="#SC-1-1-field-initialization-takes-great-efforts" class="headerlink" title="SC-1-1: field-initialization takes great efforts"></a>SC-1-1: field-initialization takes great efforts</h3><p>It makes sense to use <code>lazy</code> on a class field if its initialization requires a long time to run, and we don’t want to do the job when we instantiate the class until we actually use the field.</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span> </span>&#123;</div><div class="line">  <span class="keyword">lazy</span> <span class="keyword">val</span> text = io.<span class="type">Source</span>.fromFile(<span class="string">"/etc/passwd"</span>).getLines.foreach(println)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">object</span> <span class="title">Test</span> <span class="keyword">extends</span> <span class="title">App</span> </span>&#123;</div><div class="line">  <span class="keyword">val</span> f = <span class="keyword">new</span> <span class="type">Foo</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>In above example, the initialization of <code>text</code> needs to retrieve the contents of the text file <code>/etc/passwd</code>. But when this code is compiled and run, there is no output, because the text field isn’t initialized until it’s accessed. That’s how a lazy field works.</p>
<h3 id="SC-1-2-field-initialization-has-dependencies"><a href="#SC-1-2-field-initialization-has-dependencies" class="headerlink" title="SC-1-2: field-initialization has dependencies"></a>SC-1-2: field-initialization has dependencies</h3><p>Sometimes we need to initialize fields in a specific order because they have dependency on the other. Then we may produce following ugly codes:</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">SparkStreamDemo</span> <span class="keyword">extends</span> <span class="title">Serializable</span> </span>&#123;</div><div class="line"></div><div class="line">  <span class="meta">@transient</span> <span class="keyword">private</span> <span class="keyword">var</span> conf: <span class="type">SparkConf</span> = <span class="literal">null</span></div><div class="line">  <span class="meta">@transient</span> <span class="keyword">private</span> <span class="keyword">var</span> sc: <span class="type">SparkContext</span> = <span class="literal">null</span></div><div class="line">  <span class="meta">@transient</span> <span class="keyword">private</span> <span class="keyword">var</span> ssc: <span class="type">StreamingContext</span> = <span class="literal">null</span></div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">getConf</span></span>() = &#123;</div><div class="line">    <span class="keyword">if</span> (conf == <span class="literal">null</span>)</div><div class="line">      conf = <span class="keyword">new</span> <span class="type">SparkConf</span>()</div><div class="line">    conf</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">getSC</span></span>() = &#123;</div><div class="line">    <span class="keyword">if</span> (sc == <span class="literal">null</span>)</div><div class="line">      sc = <span class="keyword">new</span> <span class="type">SparkContext</span>(getConf)</div><div class="line">    sc</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">getSSC</span></span>() = &#123;</div><div class="line">    <span class="keyword">if</span> (ssc == <span class="literal">null</span>)</div><div class="line">      ssc = <span class="keyword">new</span> <span class="type">StreamingContext</span>(getSC, <span class="type">Seconds</span>(<span class="number">10</span>))</div><div class="line">    ssc</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>In this spark-streaming demo, the initialization of <code>ssc</code> depends on that of <code>sc</code>, which further depends on <code>conf</code>. We operate the initialize manually, thus we define these fields with <code>var</code>, and implement the lazy initialization in getters. The shortcoming is obvious, we have to restrict the access of these field through getters, otherwise we may get the null-valued ones! Moreover, defining <code>var</code> to these fields is not best-practice since they are readonly after initialization. A modified version via <code>lazy val/var</code> is as follows:</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">SparkStreamDemo</span> <span class="keyword">extends</span> <span class="title">Serializable</span> </span>&#123;</div><div class="line">  <span class="meta">@transient</span> <span class="keyword">lazy</span> <span class="keyword">val</span> conf: <span class="type">SparkConf</span> = <span class="keyword">new</span> <span class="type">SparkConf</span>()</div><div class="line">  <span class="meta">@transient</span> <span class="keyword">lazy</span> <span class="keyword">val</span> sc: <span class="type">SparkContext</span> = <span class="keyword">new</span> <span class="type">SparkContext</span>(conf)</div><div class="line">  <span class="meta">@transient</span> <span class="keyword">lazy</span> <span class="keyword">val</span> ssc: <span class="type">StreamingContext</span> = <span class="keyword">new</span> <span class="type">StreamingContext</span>(sc, <span class="type">Seconds</span>(<span class="number">10</span>))</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>What if a <code>lazy</code> field depends on a <code>non-lazy</code> var, which is not properly initialzed? Can the instance be re-used after some <code>NullPointerException</code>-like error raised? This seems no problem as scala provides a tricky, as @ViktorKlang posted on Twitter:</p>
<blockquote>
<p>Little known Scala fact: if the initialization of a lazy val throws an exception, it will attempt to reinitialize the val at next access.</p>
</blockquote>
<p>You can check the details here: <a href="http://scalapuzzlers.com/#pzzlr-012" target="_blank" rel="external">http://scalapuzzlers.com/#pzzlr-012</a></p>
<h2 id="FT-2-by-name-parameter"><a href="#FT-2-by-name-parameter" class="headerlink" title="FT-2: by-name parameter"></a>FT-2: by-name parameter</h2><p>The by-name parameter can be considered equivalent to <code>() =&gt; Int</code>, which is a <code>Function type</code> that takes a Unit type argument. Besides from normal functions, it can also be used with an <code>Object</code> and <code>apply</code> to make interesting block-like calls.</p>
<h3 id="SC-2-1-wrapper-function"><a href="#SC-2-1-wrapper-function" class="headerlink" title="SC-2-1: wrapper function"></a>SC-2-1: wrapper function</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// A benchmark construct:</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">benchmark</span> </span>(body : =&gt; <span class="type">Unit</span>) : <span class="type">Long</span> = &#123;</div><div class="line">  <span class="keyword">val</span> start = java.util.<span class="type">Calendar</span>.getInstance().getTimeInMillis()</div><div class="line">  body</div><div class="line">  <span class="keyword">val</span> end = java.util.<span class="type">Calendar</span>.getInstance().getTimeInMillis()</div><div class="line">  end - start</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">val</span> time = benchmark &#123;</div><div class="line">  <span class="keyword">var</span> i = <span class="number">0</span> ;</div><div class="line">  <span class="keyword">while</span> (i &lt; <span class="number">1000000</span>) &#123;</div><div class="line">    i += <span class="number">1</span> ;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">println(<span class="string">"while took:   "</span> + time)</div></pre></td></tr></table></figure>
<h3 id="SC-2-2-Add-syntactic-sugar"><a href="#SC-2-2-Add-syntactic-sugar" class="headerlink" title="SC-2-2: Add syntactic sugar"></a>SC-2-2: Add syntactic sugar</h3><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// While loops are syntactic sugar in Scala:</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">myWhile</span> </span>(cond : =&gt; <span class="type">Boolean</span>) (body : =&gt; <span class="type">Unit</span>) : <span class="type">Unit</span> =</div><div class="line">  <span class="keyword">if</span> (cond) &#123; body ; myWhile (cond) (body) &#125; <span class="keyword">else</span> ()</div><div class="line"></div><div class="line"><span class="keyword">var</span> i = <span class="number">0</span> ;</div><div class="line"></div><div class="line">myWhile (i &lt; <span class="number">4</span>) &#123; i += <span class="number">1</span> ; println (i) &#125;</div></pre></td></tr></table></figure>
<p>Accompany with <code>curry</code>, we re-implement a while-loop in above example.</p>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  


          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="http://img1.bimg.126.net/photo/Rm9TcTLaV0KuXDr36fyNNg==/1737263556258260335.jpg"
               alt="bailaohe" />
          <p class="site-author-name" itemprop="name">bailaohe</p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">9</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              
                <span class="site-state-item-count">2</span>
                <span class="site-state-item-name">分类</span>
              
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">16</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        <div class="links-of-blogroll motion-element">
          
        </div>

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">bailaohe</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>



      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  


  




<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>

  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=0.5.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=0.5.0"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=0.5.0"></script>



  



  



  
  
  

  

  

</body>
</html>
